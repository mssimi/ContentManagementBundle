{% extends '@ContentManagement/base.html.twig' %}

{% block title %}{{ ('menu.heading')|trans }}{% endblock %}
{% block content %}
    <div class="page-header">
        <div class="page-title">
            <h3>{{ ('menu.heading')|trans }}</h3>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-body">
            <a class="btn btn-default" href="{{ path('_mssimi_menu_new') }}">{{ ('common.new')|trans }}</a>
            <form class="form-inline pull-right" action="{{ path('_mssimi_menu_search_index') }}" method="get">
                <input placeholder="search by nodename" class="form-control" name="name" type="text">
                <button class="btn btn-default" type="submit">{{ ('common.submit')|trans }}</button>
            </form>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h6 class="panel-title">{{ ('menu.list')|trans }}</h6>
        </div>

        <div class="panel-body">
            <table class="table table-bordered table-tree">
                <thead>
                    <tr>
                        <th>{{ ('node.name')|trans }}</th>
                        <th>{{ ('node.label')|trans }}</th>
                        <th>{{ ('node.link')|trans }}</th>
                        <th>{{ ('node.targetBlank')|trans }}</th>
                        <th>{{ ('common.tools')|trans }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% include '@ContentManagement/Menu/node.html.twig' %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="treeview12" class=""></div>
{% endblock %}
{% block javascripts %}
    <script>
        var tree = $('.table-tree');

        tree.treetable({
            expandable: true,
            onNodeCollapse: function() {
                var node = this;
                tree.treetable("unloadBranch", node);
            },
            onNodeExpand: function() {
                var node = this;

                $.ajax({
                    async: false,
                    url: Routing.generate('_mssimi_menu_load', {"id" : node.id})
                }).done(function(html) {
                    var rows = $(html).filter("tr");

                    tree.treetable("loadBranch", node, rows);
                });
            }
        });
    </script>
{% endblock %}
